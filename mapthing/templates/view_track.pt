<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" xmlns:tal="http://xml.zope.org/namespaces/tal">
<head>
    <title>View Track</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <!-- 
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    -->
    <script src="${request.static_url('mapthing:static/bower_components/jquery/jquery.js')}"></script>
    <script src="${request.static_url('mapthing:static/bower_components/jquery-ui/ui/jquery-ui.js')}"></script>
    
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
    <!-- 
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/ui-lightness/jquery-ui.css" />
    -->
    <link rel="stylesheet" href="${request.static_url('mapthing:static/bower_components/jquery-ui/themes/ui-lightness/jquery-ui.css')}" type="text/css" charset="utf-8" />
    <link rel="shortcut icon" href="${request.static_url('mapthing:static/favicon.ico')}" />
    <link rel="stylesheet" href="${request.static_url('mapthing:static/pylons.css')}" type="text/css" media="screen" charset="utf-8" />
    <link rel="stylesheet" href="${request.static_url('mapthing:static/css/jquery.ui.timerange.css')}" type="text/css" charset="utf-8" />
    <!--[if lte IE 6]>
    <link rel="stylesheet" href="${request.static_url('mapthing:static/ie6.css')}" type="text/css" media="screen" charset="utf-8" />
    <![endif]-->
    <script src="http://openlayers.org/api/OpenLayers.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
    <script src="http://openlayers.org/api/OpenLayers.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script src="${request.static_url('mapthing:static/mapstraction/source/mxn.js')}?(leaflet)" type="text/javascript"></script>
    <script src="${request.static_url('mapthing:static/js/jquery.ui.timerange.js')}" type="text/javascript"></script>
    <script src="${request.static_url('mapthing:static/js/moment.min.js')}" type="text/javascript"></script>
    <script type="text/javascript">
        var params = ${json_params};
    </script>
    <script src="${request.static_url('mapthing:static/js/mapthing.js')}" type="text/javascript"></script>
    <style>
        #trips { 
            height: 400px; 
            width: 25%; 
            float: left; 
            overflow-y: scroll;
        }
        #map {
            height: 400px;
            width: 75%;
            float: left; 
        }
        .sel_view, .uni_view {
            height: 1em;
            border: 1px solid;
            width: 100%;
            clear: both;
        }
        .sel_view canvas {
            width: 100%;
            height: 100%;
            position: relative;
            top: -3px;
        }
        .uni_view canvas {
            width: 100%;
            height: 100%;
        }

        #details {
            float: right;
        }
    </style>
</head>
<body ng-controller="mapController" ng-app="mapApp">
    <h1 id="full_timerange" ng-show="params.track_range">
        {{params.track_range[0]*1000|date:'MMM d, yyyy H:mm'}}
        -
        {{params.track_range[1]*1000|date:'MMM d, yyyy H:mm'}}
    </h1>
    <h2 id="sel_timerange" ng-show="params.view_range.length">{{params.view_range|humanize}}</h2>
    <div id="details">
        <div id="uni_controls">
            <label for="uni_interval">Interval</label>
            <input id="uni_interval" type="text" ng-model="uni.interval" value="5"/> seconds
            <label for="uni_interp">Interpolation Threshhold</label>
            <input id="uni_interp" type="text" ng-model="uni.interp" value="10"/> seconds
        </div>
        <div id="upload">
            <form action="/upload" enctype="multipart/form-data" method="POST">
                Add data: <input type="file" name="data"/>
                <input type="submit" value="Upload"/>
            </form>
        </div>
        <button id="getarea">Get All in Map</button>
    </div>
    <div style="clear: both;"></div>
   	<div id="datepicker"></div>
    <div>
        <div id="trips">
            <ul id="triplist">
                <li ng-repeat="trip in data.view_points.trips" data-start="{{trip.start/1000}}" data-end="{{trip.end/1000}}">
                    <a href="#" ng-mouseover="params.active_trip = $index" ng-mouseout="params.active_trip = null">Trip {{$index}} ({{(trip.end-trip.start)/1000/60|number:1}} min)</a>
                </li>
            </ul>
        </div>
        <path-map id="map"
            data="data.map"
            range="params.tick_range">
        ></path-map>
    </div>
   	<div id="timeline"></div>
    <track-sel
        start="params.start"
        end="params.end"
        selrange="params.track_range"
        bounds="params.track_bounds">
    </track-sel>
    <point-sel
        range="params.track_range"
        selrange="params.view_range"
        uni-params="uni"
        uni-data="data.map.spans"
        point-data="data.view_points">
    </point-sel>
    <anim-control></anim-control>

    <script type="text/ng-template" id="anim_controls.html">
        <div class="anim_playpos"></div>
        <div class="anim_controls">
            <button ng-click="setAnim('step',-1)">&#x23EE;</button>
            <button ng-click="setAnim('rewind')">&#x23EA;</button>
            <button ng-click="setAnim('pausestop')">&#x25A0; &#x25AE; &#x25AE;</button>
            <button ng-click="setAnim('play')">&#x25B8;</button>
            <button ng-click="setAnim('step',1)">&#x23ED;</button>

            <!--
            Bigger play: &#x25B6;<br/>
            Pause: &#x25AE;&#x25AE;<br/>

            Other pauses:
            &#x2503;&#x2503;<br/>
            &#x275A;&#x275A;<br/>
            &#x2590;&#x2590;<br/>
            -->
        </div>
        <div class="anim_options">
            FPS: <input type="text" ng-model="anim.fps" value="2"/>
            Speedup: <input type="text" ng-model="anim.speedup" value="60"/>
            Trail length (sec): <input type="text" ng-model="anim.traillen" value="300"/>
        </div>
    </script>
    <script type="text/ng-template" id="track_sel.html">
        <ul>
            <li ng-repeat="track in tracks"
                data-start="{{track.start|date:'yyyy-MM-ddTHH:mm:ss'}}"
                data-end="{{track.end|date:'yyyy-MM-ddTHH:mm:ss'}}"
                notify-last>
                <a href="#" data-trackid="{{track.id}}">
                    ({{track.id}})
                    ({{track.start|date:'yyyy/MM/dd h:mm'}} - {{track.end|date:'yyyy/MM/dd h:mm'}})
                </a>
            </li>
        </ul>
    </script>
    <script src="${request.static_url('mapthing:static/bower_components/angular/angular.js')}" type="text/javascript"></script>
    <script src="${request.static_url('mapthing:static/bower_components/angular-resource/angular-resource.js')}" type="text/javascript"></script>
    <script src="${request.static_url('mapthing:static/js/app/app.js')}" type="text/javascript"></script>
    <script src="${request.static_url('mapthing:static/js/app/controllers.js')}" type="text/javascript"></script>
    <script src="${request.static_url('mapthing:static/js/app/directives.js')}" type="text/javascript"></script>
    <script src="${request.static_url('mapthing:static/js/app/services.js')}" type="text/javascript"></script>
    <script src="${request.static_url('mapthing:static/js/app/filters.js')}" type="text/javascript"></script>
</body>
</html>
